<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Лада-Имидж. Учёт затрат процессов</title>
  <meta name="description" content="Веб‑приложение Лада‑Имидж: учёт затрат процессов, PnL по ABC, оргструктура и аналитика." />
  <meta name="theme-color" content="#ffffff"/>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet"/>
  <link rel="preconnect" href="https://unpkg.com" crossorigin>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="stylesheet" href="styles.css"/>
</head>
<body>
  <!-- Header -->
  <header class="main-header" role="banner">
    <button id="sidebarToggle" class="icon-button" aria-label="Свернуть/развернуть меню">
      <i data-lucide="panel-left-close" aria-hidden="true"></i>
    </button>
    <div class="title-container">
      <i data-lucide="workflow" class="main-icon" aria-hidden="true"></i>
      <div class="titles">
        <h1 class="page-title">Лада-Имидж. Бизнес-архитектура</h1>
        <p class="subtitle">Люди / Процессы / Данные</p>
      </div>
    </div>

    <!-- ===== ИЗМЕНЕННЫЙ БЛОК ПРОФИЛЯ ПОЛЬЗОВАТЕЛЯ ===== -->
    <div class="user-area">
      <button id="userMenuButton" class="avatar-button" aria-haspopup="true" aria-expanded="false" aria-controls="userMenu">
        <i data-lucide="smile" class="avatar-icon"></i>
        <i data-lucide="chevron-down" class="chevron" aria-hidden="true"></i>
      </button>
      
      <div id="userMenu" class="user-menu" role="menu" aria-hidden="true">
        <div class="user-menu__header">
          <div class="avatar-icon-large"><i data-lucide="smile"></i></div>
          <div class="user-menu__info">
            <span class="user-menu__name">Роман Шапкин</span>
            <span class="user-menu__email">roman.shapkin@vaz.ru</span>
          </div>
        </div>
        
        <div class="user-menu__group">
          <button class="user-menu__item" role="menuitem" data-modal-target="profileModal">
            <i data-lucide="user" aria-hidden="true"></i><span>Мой профиль</span>
          </button>
          <button class="user-menu__item" role="menuitem" data-modal-target="settingsModal">
            <i data-lucide="settings" aria-hidden="true"></i><span>Настройки</span>
          </button>
        </div>
        
        <div class="user-menu__group">
          <button class="user-menu__item" role="menuitem">
            <i data-lucide="bell" aria-hidden="true"></i><span>Уведомления</span>
          </button>
          <button class="user-menu__item" role="menuitem">
            <i data-lucide="help-circle" aria-hidden="true"></i><span>Помощь</span>
          </button>
        </div>
        
        <div class="user-menu__group">
          <button class="user-menu__item user-menu__item--danger" role="menuitem">
            <i data-lucide="log-out" aria-hidden="true"></i><span>Выход</span>
          </button>
        </div>
      </div>
    </div>
    <!-- ===== КОНЕЦ ИЗМЕНЕННОГО БЛОКА ===== -->
  </header>

  <div class="layout">
    <!-- Sidebar -->
    <aside class="sidebar" aria-label="Навигация">
      <nav class="nav">
        <a class="nav-item active" href="#" title="Главная" aria-current="page"><i data-lucide="castle" aria-hidden="true"></i><span>Главная</span></a>
        <a class="nav-item" href="#" title="Затраты процессов"><i data-lucide="chart-pie" aria-hidden="true"></i><span>Затраты процессов</span></a>
        <a class="nav-item" href="#" title="Бизнес-функции"><i data-lucide="waypoints" aria-hidden="true"></i><span>Бизнес-функции</span></a>
        <a class="nav-item" href="#" title="Оргструктура"><i data-lucide="drama" aria-hidden="true"></i><span>Оргструктура</span></a>
        <a class="nav-item" href="#" title="Аналитика"><i data-lucide="chart-spline" aria-hidden="true"></i><span>Аналитика</span></a>
      </nav>
    </aside>

    <!-- Content -->
    <main id="app-container" class="content" role="main"></main>
  </div>

  <!-- Footer -->
  <footer class="main-footer" role="contentinfo">
    <div class="footer-left">© <span id="year"></span> Лада-Имидж</div>
    <div class="footer-right"><i data-lucide="workflow" aria-hidden="true"></i><span>ДКАБП.tech</span></div>
  </footer>

  <!-- ===== МОДАЛЬНЫЕ ОКНА ===== -->
  <div class="modal-overlay" id="profileModalOverlay" aria-hidden="true">
    <div class="modal" id="profileModal" role="dialog" aria-modal="true" aria-labelledby="profileModalTitle">
      <div class="modal__header">
        <h2 id="profileModalTitle" class="modal__title">Мой профиль</h2>
        <button class="modal__close" aria-label="Закрыть"><i data-lucide="x"></i></button>
      </div>
      <div class="modal__body">
        <form>
          <div class="form-group">
            <label for="profileName">Имя</label>
            <input type="text" id="profileName" value="Роман Шапкин" disabled>
          </div>
          <div class="form-group">
            <label for="profileEmail">Email</label>
            <input type="email" id="profileEmail" value="roman.shapkin@vaz.ru" disabled>
          </div>
          <div class="form-group">
            <label for="profileRole">Роль в системе</label>
            <input type="text" id="profileRole" value="Бизнес-архитектор" disabled>
          </div>
        </form>
      </div>
      <div class="modal__footer">
        <button class="btn">Закрыть</button>
      </div>
    </div>
  </div>

  <div class="modal-overlay" id="settingsModalOverlay" aria-hidden="true">
    <div class="modal" id="settingsModal" role="dialog" aria-modal="true" aria-labelledby="settingsModalTitle">
      <div class="modal__header">
        <h2 id="settingsModalTitle" class="modal__title">Настройки</h2>
        <button class="modal__close" aria-label="Закрыть"><i data-lucide="x"></i></button>
      </div>
      <div class="modal__body">
        <form>
          <div class="form-group">
            <label for="settingLang">Язык интерфейса</label>
            <select id="settingLang"><option>Русский</option><option>English</option></select>
          </div>
          <div class="form-group checkbox-group">
            <input type="checkbox" id="emailNotifications" checked>
            <label for="emailNotifications">Получать email-уведомления</label>
          </div>
          <div class="form-group checkbox-group">
            <input type="checkbox" id="pushNotifications">
            <label for="pushNotifications">Получать push-уведомления</label>
          </div>
        </form>
      </div>
      <div class="modal__footer">
        <button class="btn modal__close">Отмена</button>
        <button class="btn btn-primary">Сохранить</button>
      </div>
    </div>
  </div>
  <!-- ===== КОНЕЦ МОДАЛЬНЫХ ОКОН ===== -->

  <!-- Runtime-конфиг -->
  <script>
    window.ENV = {
      SUPABASE_URL: "https://eqpdepmgriuivevvrulc.supabase.co",
      SUPABASE_ANON_KEY: "sb_publishable_jXWjFZYC1JvEL7n8tgygJw_QZ9kBcaT"
    };
  </script>

  <!-- Vendor scripts -->
  <script src="https://cdn.jsdelivr.net/npm/lucide@0.468.0/dist/umd/lucide.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.1/dist/umd/supabase.min.js" defer></script>

  <!-- App -->
  <script type="module" src="js/main.js" defer></script>
  
  <!-- Inline script для модальных окон (чтобы не трогать main.js) -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const modalTriggers = document.querySelectorAll('[data-modal-target]');
      
      modalTriggers.forEach(trigger => {
        trigger.addEventListener('click', () => {
          const modalId = trigger.dataset.modalTarget;
          const overlay = document.getElementById(`${modalId}Overlay`);
          if (overlay) {
            overlay.classList.add('open');
            overlay.setAttribute('aria-hidden', 'false');
          }
        });
      });

      document.querySelectorAll('.modal-overlay').forEach(overlay => {
        overlay.addEventListener('click', (e) => {
          if (e.target === overlay || e.target.closest('.modal__close')) {
            overlay.classList.remove('open');
            overlay.setAttribute('aria-hidden', 'true');
          }
        });
      });
    });
  </script>

  <noscript>Для работы приложения требуется включить JavaScript.</noscript>
</body>
</html>